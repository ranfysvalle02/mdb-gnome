<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ quiz_title }} - {{ project_name }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #f1f5f9; }
        .quiz-container { max-width: 800px; margin: 40px auto; padding: 30px; background-color: #fff; border-radius: 12px; box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); }
        .question-block { margin-bottom: 2rem; }
        .options-list { list-style-type: none; padding-left: 0; }
        .option-item { margin-bottom: 0.5rem; }
        .option-label { display: block; padding: 12px 18px; border: 1px solid #e2e8f0; border-radius: 8px; cursor: pointer; transition: all 0.2s; }
        .option-label:hover { background-color: #f8fafc; border-color: #cbd5e1; }
        .option-radio { display: none; }
        .option-radio:checked + .option-label { background-color: #4f46e5; color: white; border-color: #4f46e5; font-weight: 600; }
        .feedback { margin-top: 10px; padding: 12px; border-radius: 8px; display: none; font-weight: 500;}
        .feedback.correct { background-color: #dcfce7; color: #166534; border-left: 4px solid #22c55e; }
        .feedback.incorrect { background-color: #fee2e2; color: #991b1b; border-left: 4px solid #ef4444; }
        #score-container { text-align: center; }
        .btn { display: inline-block; padding: 12px 24px; border-radius: 8px; text-decoration: none; font-weight: 600; transition: background-color 0.2s; text-align: center; cursor: pointer; border: none; }
        .btn-primary { background-color: #4f46e5; color: white; }
        .btn-primary:hover { background-color: #4338ca; }
        .btn-secondary { background-color: #64748b; color: white; }
        .btn-secondary:hover { background-color: #475569; }
    </style>
</head>
<body>
    <div class="container mx-auto px-4">
        <div class="quiz-container">
            <h1 class="text-3xl font-extrabold mb-2 text-center text-slate-900">{{ quiz_title }}</h1>
            <p class="text-slate-500 text-center mb-6">From Project: <strong>{{ project_name }}</strong></p>
            <hr class="mb-8">
            
            <form id="quizForm">
                {% for question in quiz %}
                {% set question_index = loop.index0 %}
                <div class="question-block" id="question-{{ question_index }}">
                    <p class="font-semibold text-lg text-slate-800">{{ loop.index }}. {{ question.question }}</p>
                    
                    {% if question_type == 'True/False' %}
                    <ul class="options-list mt-4 flex space-x-6">
                        <li class="option-item">
                            <input type="radio" name="question_{{ question_index }}" id="q{{ question_index }}_o_true" value="true" class="option-radio">
                            <label for="q{{ question_index }}_o_true" class="option-label">True</label>
                        </li>
                        <li class="option-item">
                            <input type="radio" name="question_{{ question_index }}" id="q{{ question_index }}_o_false" value="false" class="option-radio">
                            <label for="q{{ question_index }}_o_false" class="option-label">False</label>
                        </li>
                    </ul>
                    {% else %} {# Default to Multiple Choice #}
                    <ul class="options-list mt-4">
                        {% for option in question.options %}
                        <li class="option-item">
                            <input type="radio" name="question_{{ question_index }}" id="q{{ question_index }}_o{{ loop.index0 }}" value="{{ loop.index0 }}" class="option-radio">
                            <label for="q{{ question_index }}_o{{ loop.index0 }}" class="option-label">{{ option }}</label>
                        </li>
                        {% endfor %}
                    </ul>
                    {% endif %}
                    <div class="feedback" id="feedback-{{ question_index }}"></div>
                </div>
                {% endfor %}
                <div class="mt-8 text-center">
                    <button type="submit" class="btn btn-primary w-full sm:w-auto">Check Answers</button>
                </div>
            </form>
            <div id="score-container" class="mt-8 text-center" style="display: none;">
                <h2 id="score-text" class="text-2xl font-bold text-slate-900"></h2>
                <div class="flex flex-col sm:flex-row justify-center items-center gap-4 mt-6">
                    <button id="retake-quiz-btn" class="btn btn-secondary w-full sm:w-auto">Retake Quiz</button>
                    <button id="share-results-btn" class="btn btn-primary w-full sm:w-auto">Share Results</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const quizData = {{ quiz|tojson }};
            const questionType = {{ question_type|tojson }};
            const quizTitle = {{ quiz_title|tojson }};
            const form = document.getElementById('quizForm');
            let finalScore = 0;
            
            form.addEventListener('submit', function(event) {
                event.preventDefault();
                let score = 0;
                
                quizData.forEach((questionData, index) => {
                    const feedbackEl = document.getElementById(`feedback-${index}`);
                    const selectedOption = form.querySelector(`input[name="question_${index}"]:checked`);
                    
                    if (selectedOption) {
                        let isCorrect = false;
                        let correctAnswerText = '';
                        if (questionType === 'True/False') {
                            const userAnswer = selectedOption.value === 'true';
                            isCorrect = (userAnswer === questionData.answer);
                            correctAnswerText = questionData.answer ? 'True' : 'False';
                        } else { // Multiple Choice
                            const userAnswer = parseInt(selectedOption.value, 10);
                            isCorrect = (userAnswer === questionData.correct_answer_index);
                            correctAnswerText = questionData.options[questionData.correct_answer_index];
                        }
                        
                        if (isCorrect) {
                            score++;
                            feedbackEl.textContent = 'Correct!';
                            feedbackEl.className = 'feedback correct';
                        } else {
                            feedbackEl.textContent = `Incorrect. The correct answer was: "${correctAnswerText}"`;
                            feedbackEl.className = 'feedback incorrect';
                        }
                    } else {
                        feedbackEl.textContent = 'You did not answer this question.';
                        feedbackEl.className = 'feedback incorrect';
                    }
                    feedbackEl.style.display = 'block';
                });
                finalScore = score;
                document.getElementById('score-text').textContent = `Your Score: ${score} out of ${quizData.length}`;
                document.getElementById('score-container').style.display = 'block';
                form.querySelector('button[type="submit"]').style.display = 'none';
            });
            
            document.getElementById('retake-quiz-btn').addEventListener('click', function() {
                form.reset();
                document.querySelectorAll('.feedback').forEach(el => { el.style.display = 'none'; el.className = 'feedback'; });
                document.querySelectorAll('.option-label').forEach(label => { label.removeAttribute('style'); });
                document.getElementById('score-container').style.display = 'none';
                form.querySelector('button[type="submit"]').style.display = 'block';
            });
            
            document.getElementById('share-results-btn').addEventListener('click', async function() {
                const shareText = `I scored ${finalScore} out of ${quizData.length} on the "${quizTitle}" quiz! Try it yourself.`;
                const shareUrl = window.location.href;
                const shareData = {
                    title: `Quiz Results: ${quizTitle}`, text: shareText, url: shareUrl,
                };
                
                try {
                    if (navigator.share) {
                        await navigator.share(shareData);
                    } else {
                        await navigator.clipboard.writeText(`${shareText}\n${shareUrl}`);
                        this.textContent = 'Copied!';
                        setTimeout(() => { this.textContent = 'Share Results'; }, 2000);
                    }
                } catch (err) {
                    console.error("Couldn't share results:", err);
                    alert("Sharing failed. You can manually copy the link.");
                }
            });
        });
    </script>
</body>
</html>
